### 【仕様書】Cloudflareフルスタック予約管理システム

#### 1. アプリ概要
* **アプリ名**: Cloud-Native 予約管理システム 『Appointy』
* **コンセプト**: 小規模な店舗や個人事業主（例：サロン、コンサルタント、個人レッスン講師）が、自身のサービスと予約可能時間を設定し、顧客がオンラインで簡単に予約できるシステム。
* **ポートフォリオとしてのアピールポイント**:
    * Nuxt 3を使い、フロントエンドとバックエンドを一体的に開発するスキル。
    * Cloudflareのサーバーレスプラットフォーム（Workers, D1, R2）をフル活用し、高速・高可用性・低コストなアプリケーションを構築できる能力を証明する。

#### 2. 主な機能（MVP: Minimum Viable Product）

1.  **管理者（店舗オーナー）向け機能**
    * **認証機能**: メールアドレスとパスワードでログイン・ログアウトできる。
    * **サービス設定**: 提供するサービス（例：「カット」「60分カウンセリング」）の名称、所要時間、料金を登録・編集・削除（CRUD）できる。
    * **予約管理ダッシュボード**:
        * カレンダー形式で、どの時間にどの予約が入っているかを一覧表示。
        * 予約の詳細確認、手動での予約キャンセルができる。
        * 予約が入っている時間をクリックすると、顧客情報（名前、連絡先）が表示される。

2.  **顧客（予約者）向け機能**
    * **公開予約ページ**: 管理者が設定したサービスの一覧と、予約可能な時間枠がカレンダーに表示される。
    * **予約機能**: 希望のサービスと時間枠を選択し、自身の名前とメールアドレスを入力して予約を確定できる。
    * 予約完了後、確認画面が表示される。

#### 3. 発展機能（アピールポイント）

1.  **管理者プロフィール機能（R2活用）**
    * 管理者が自身のプロフィール情報（名前、自己紹介文）を編集できる。
    * **プロフィール画像をアップロードし、公開予約ページに表示する機能。（ここでR2を使用）**

2.  **自動メール通知機能（MailChannels活用）**
    * 顧客が予約を完了した際に、管理者と顧客の両方に予約確認メールを自動送信する。
    * 予約日の前日に、顧客へリマインドメールを自動送信する。
    * (Cloudflare Workersは、MailChannelsというサービスと連携することで無料でメール送信が可能です)

3.  **Googleカレンダー連携**
    * 管理者が自身のGoogleアカウントと連携すると、予約成立時に自動で自身のGoogleカレンダーに予定が登録される。

#### 4. 画面構成案

* **管理者側画面**
    1.  ` /admin/login ` : ログイン画面
    2.  ` /admin/dashboard ` : 予約カレンダーが表示されるメイン画面
    3.  ` /admin/services ` : サービス内容を管理（CRUD）する画面
    4.  ` /admin/settings ` : プロフィール編集、画像アップロード画面

* **顧客側画面**
    1.  ` / `: 公開予約カレンダーページ。サービスを選択し、空き時間を確認できる。
    2.  ` /book `: 時間を選択後、予約者情報を入力するフォーム画面。
    3.  ` /thanks `: 予約完了後のサンクスページ。

#### 5. 使用技術スタック（Cloudflareフルスタック）

* **フレームワーク**: **Nuxt 3**
* **実行環境**:
    * フロントエンド: **Cloudflare Pages**(tailwindcssを使ってモダンなデザインにする)
    * バックエンドAPI: **Cloudflare Workers** (Nuxt 3の`server/`ディレクトリ内で実装)
* **データベース**: **Cloudflare D1** (SQLベース)
* **ファイルストレージ**: **Cloudflare R2** (プロフィール画像用)
* **メール送信**: **MailChannels** (Cloudflare Workersとの連携)

#### 6. 開発環境
- 開発にはdevdockerを使う
- 開発時のR2の代わりはDockerのminioを使う

#### 7. データベース(D1) & ストレージ(R2)設計

* **Cloudflare D1 データベース設計**

    * `users` テーブル (管理者情報)
        | カラム名 | データ型 | 説明 |
        | :--- | :--- | :--- |
        | `id` | TEXT | 主キー (UUID) |
        | `name` | TEXT | 管理者名 |
        | `email` | TEXT | メールアドレス (UNIQUE) |
        | `hashed_password` | TEXT | ハッシュ化されたパスワード |
        | `profile_image_key` | TEXT | R2に保存した画像キー (NULL可) |

    * `services` テーブル (提供サービス)
        | カラム名 | データ型 | 説明 |
        | :--- | :--- | :--- |
        | `id` | INTEGER | 主キー (自動採番) |
        | `user_id` | TEXT | `users`テーブルへの外部キー |
        | `name` | TEXT | サービス名 (例: 60分カウンセリング) |
        | `duration_minutes` | INTEGER | 所要時間（分） |
        | `price` | INTEGER | 料金 |

    * `reservations` テーブル (予約情報)
        | カラム名 | データ型 | 説明 |
        | :--- | :--- | :--- |
        | `id` | INTEGER | 主キー (自動採番) |
        | `service_id` | INTEGER | `services`テーブルへの外部キー |
        | `customer_name` | TEXT | 顧客名 |
        | `customer_email` | TEXT | 顧客のメールアドレス |
        | `start_time` | TEXT | 予約開始日時 (ISO 8601形式) |
        | `end_time` | TEXT | 予約終了日時 (ISO 8601形式) |

* **Cloudflare R2 ストレージ戦略**
    * `users`テーブルの`profile_image_key`には、画像そのものではなく、R2にアップロードした際のファイル名（キー）のみを保存します。（例: `user-xxxx-xxxx-xxxx.jpg`）
    * バックエンド（Worker）で、画像のアップロード用の「署名付きURL」を生成し、フロントエンドに渡します。フロントエンドは、そのURLを使って直接R2に画像をアップロードします。

