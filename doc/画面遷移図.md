# Appointy 画面遷移図

## 詳細画面遷移図

```mermaid
graph TD
    A["トップページ<br/>/"] 
    B["予約ページ<br/>/booking"]
    C["オーナーログイン<br/>/owner/login"]
    D["カスタマーログイン<br/>/customer/login"]
    E["カスタマー登録<br/>/customer/register"]
    F["オーナーダッシュボード<br/>/owner/dashboard"]
    
    %% トップページからの遷移
    A -->|"「予約する」ボタンクリック"| B
    A -->|"「オーナーログイン」リンククリック"| C
    
    %% 予約ページからの遷移
    B -->|"「ログインして予約する」ボタンクリック<br/>(未ログイン時)"| D
    B -->|"ヘッダーロゴクリック"| A
    
    %% カスタマーログインページからの遷移
    D -->|"「新規登録」リンククリック"| E
    D -->|"「トップページに戻る」リンククリック"| A
    D -->|"ログイン成功<br/>(redirect=/bookingの場合)"| B
    D -->|"ログイン成功<br/>(redirect指定なし)"| B
    
    %% カスタマー登録ページからの遷移
    E -->|"「ログイン」リンククリック"| D
    E -->|"「トップページに戻る」リンククリック"| A
    E -->|"登録成功<br/>(自動ログイン)"| B
    
    %% オーナーログインページからの遷移
    C -->|"ログイン成功<br/>(redirect指定なし)"| F
    C -->|"ログイン成功<br/>(redirect指定あり)"| B
    
    %% オーナーダッシュボードからの遷移
    F -->|"ログアウト操作"| A
    F -->|"ヘッダー「サービス管理」クリック"| G["サービス管理画面<br/>/owner/services"]
    F -->|"ヘッダー「予約管理」クリック"| H["予約管理画面<br/>/owner/reservations"]
    F -->|"ヘッダー「設定」クリック"| I["設定画面<br/>/owner/settings"]
    
    %% 管理画面間の遷移
    G -->|"ヘッダーナビゲーション"| F
    G -->|"ヘッダーナビゲーション"| H
    G -->|"ヘッダーナビゲーション"| I
    H -->|"ヘッダーナビゲーション"| F
    H -->|"ヘッダーナビゲーション"| G
    H -->|"ヘッダーナビゲーション"| I
    I -->|"ヘッダーナビゲーション"| F
    I -->|"ヘッダーナビゲーション"| G
    I -->|"ヘッダーナビゲーション"| H
    
    %% スタイル定義
    classDef implemented fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef auth fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef landing fill:#e1f5fe,stroke:#2196f3,stroke-width:2px
    
    %% クラス適用
    class A landing
    class B,F,G,H,I implemented
    class C,D,E auth
```

## 認証フロー

```mermaid
graph TD
    START["ユーザーアクセス"] --> CHECK{"認証状態確認"}
    CHECK -->|"未認証"| UNAUTH["未認証状態"]
    CHECK -->|"認証済み"| AUTH["認証済み状態"]
    
    UNAUTH --> |"予約ボタンクリック"| LOGIN_CHOICE{"ログイン方法選択"}
    LOGIN_CHOICE --> |"新規ユーザー"| REGISTER["カスタマー登録"]
    LOGIN_CHOICE --> |"既存ユーザー"| C_LOGIN["カスタマーログイン"]
    LOGIN_CHOICE --> |"オーナー"| O_LOGIN["オーナーログイン"]
    
    REGISTER --> |"登録成功<br/>自動ログイン"| AUTH
    C_LOGIN --> |"ログイン成功"| AUTH
    O_LOGIN --> |"ログイン成功<br/>オーナー権限"| OWNER_AUTH["オーナー認証済み"]
    
    AUTH --> |"予約操作可能"| BOOKING["予約ページ"]
    OWNER_AUTH --> |"管理機能アクセス可能"| DASHBOARD["ダッシュボード"]
    
    AUTH --> |"ログアウト"| UNAUTH
    OWNER_AUTH --> |"ログアウト"| UNAUTH
    
    classDef process fill:#e3f2fd,stroke:#1976d2
    classDef decision fill:#fff3e0,stroke:#f57c00
    classDef success fill:#e8f5e8,stroke:#388e3c
    classDef auth fill:#f3e5f5,stroke:#7b1fa2
    
    class START,REGISTER,C_LOGIN,O_LOGIN,BOOKING,DASHBOARD process
    class CHECK,LOGIN_CHOICE decision
    class AUTH,OWNER_AUTH success
    class UNAUTH auth
```

## ナビゲーション構造

### ヘッダーナビゲーション（デフォルトレイアウト）
```
[Appointy Logo] ────────────────── [予約する] [オーナーログイン]
      ↓                              ↓           ↓
   "/" へ遷移                    "/booking"  "/owner/login"
```

### オーナーヘッダーナビゲーション
```
[Appointy オーナー] ─ [ダッシュボード] [サービス管理] [予約管理] [設定] [ログアウト]
        ↓                    ↓            ↓          ↓        ↓        ↓
"/owner/dashboard"    "/owner/dashboard" "/owner/services" "/owner/reservations" "/owner/settings" "/"
```

## 遷移パターン

### 1. 一般ユーザーの予約フロー
```
トップページ → 予約ページ → カスタマーログイン → 予約ページ(認証済み) → 予約完了
     ↓              ↓              ↓                ↓
   ランディング    サービス選択    認証処理        予約フォーム送信
```

### 2. 新規ユーザーの予約フロー
```
トップページ → 予約ページ → カスタマーログイン → カスタマー登録 → 予約ページ(認証済み)
     ↓              ↓              ↓              ↓              ↓
   ランディング    サービス選択    ログイン画面    新規登録        自動ログイン
```

### 3. オーナーの管理フロー
```
トップページ → オーナーログイン → ダッシュボード → 各管理画面
     ↓              ↓              ↓              ↓
   ランディング      認証          統計・予約確認   CRUD操作
```

## リダイレクト仕様

### ログイン後のリダイレクト
- **カスタマーログイン**: `?redirect=/booking` → 予約ページへ
- **オーナーログイン**: `?redirect=` 指定なし → ダッシュボードへ
- **新規登録**: 自動で予約ページへ

### エラー時の動作
- **認証エラー**: ログインページへリダイレクト
- **権限エラー**: トップページへリダイレクト
- **404エラー**: 現在のページに留まる

## 実装状況

| 画面 | 実装状況 | 遷移実装 | 備考 |
|------|----------|----------|------|
| トップページ | ✅ 完了 | ✅ 完了 | ランディング + ナビゲーション |
| 予約ページ | ✅ 完了 | ✅ 完了 | 認証状態に応じたボタン表示 |
| カスタマーログイン | ✅ 完了 | ✅ 完了 | リダイレクト対応済み |
| カスタマー登録 | ✅ 完了 | ✅ 完了 | 自動ログイン機能 |
| オーナーログイン | ✅ 完了 | ✅ 完了 | リダイレクト対応済み |
| オーナーダッシュボード | ✅ 完了 | ✅ 完了 | ヘッダーナビゲーション実装済み |
| サービス管理 | ✅ 完了 | ✅ 完了 | CRUD機能、モーダル対応 |
| 予約管理 | ✅ 完了 | ✅ 完了 | 一覧表示、フィルター、詳細 |
| 設定画面 | ✅ 完了 | ✅ 完了 | プロフィール編集、営業時間設定 |

---
*最終更新: 2025-07-10*