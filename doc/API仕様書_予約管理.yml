openapi: 3.0.0
info:
  title: Appointy 予約管理API
  version: 1.0.0
  description: 予約管理に関するAPI仕様

servers:
  - url: /api/owner
    description: 店舗オーナー向け予約API

paths:
  /reservations:
    get:
      summary: 予約一覧取得（店舗オーナー用）
      description: 店舗オーナーが全ての予約を取得する
      security:
        - bearerAuth: []
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
            example: 2024-01-01
        - name: endDate
          in: query
          schema:
            type: string
            format: date
            example: 2024-01-31
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, cancelled]
            example: pending
        - name: date
          in: query
          schema:
            type: string
            format: date
            example: 2024-01-15
      responses:
        200:
          description: 予約一覧取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  reservations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Reservation'

  /reservations/{reservationId}:
    get:
      summary: 予約詳細取得
      description: 予約の詳細情報を取得する
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        200:
          description: 予約詳細取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationDetail'
        404:
          description: 予約が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: 予約キャンセル（店舗オーナー用）
      description: 店舗オーナーが予約をキャンセルする
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        204:
          description: 予約キャンセル成功
        404:
          description: 予約が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reservations/{reservationId}/confirm:
    put:
      summary: 予約承認
      description: 待機中の予約を承認する
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        200:
          description: 予約承認成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationDetail'
        404:
          description: 予約が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reservations/{reservationId}/reject:
    put:
      summary: 予約拒否
      description: 待機中の予約を拒否する
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: 店舗都合によりキャンセル
      responses:
        200:
          description: 予約拒否成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationDetail'
        404:
          description: 予約が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

servers:
  - url: /api/reservations
    description: 予約メッセージAPI

paths:
  /{reservationId}/messages:
    get:
      summary: 予約メッセージ一覧取得
      description: 予約に関するメッセージ一覧を取得する
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        200:
          description: メッセージ一覧取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/Message'

    post:
      summary: メッセージ送信
      description: 予約に関するメッセージを送信する
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: よろしくお願いします
      responses:
        200:
          description: メッセージ送信成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'

components:
  schemas:
    Reservation:
      type: object
      properties:
        id:
          type: integer
          example: 1
        serviceId:
          type: integer
          example: 1
        customerName:
          type: string
          example: 山田花子
        customerEmail:
          type: string
          example: customer@example.com
        startTime:
          type: string
          format: date-time
          example: 2024-01-15T10:00:00Z
        endTime:
          type: string
          format: date-time
          example: 2024-01-15T11:00:00Z
        status:
          type: string
          enum: [pending, confirmed, cancelled]
          example: pending
        createdAt:
          type: string
          format: date-time
          example: 2024-01-01T00:00:00Z

    ReservationDetail:
      allOf:
        - $ref: '#/components/schemas/Reservation'
        - type: object
          properties:
            service:
              type: object
              properties:
                id:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: 60分カウンセリング
                durationMinutes:
                  type: integer
                  example: 60
                price:
                  type: integer
                  example: 5000

    Error:
      type: object
      properties:
        error:
          type: string
          example: 予約が見つかりません
        code:
          type: string
          example: NOT_FOUND

    Message:
      type: object
      properties:
        id:
          type: integer
          example: 1
        reservationId:
          type: integer
          example: 1
        senderType:
          type: string
          enum: [owner, customer]
          example: owner
        senderName:
          type: string
          example: 店舗オーナー
        message:
          type: string
          example: よろしくお願いします
        createdAt:
          type: string
          format: date-time
          example: 2024-01-01T00:00:00Z

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT